#!/bin/bash

# --- GPG Windows Bridge ---

SOCAT_PID_FILE=$HOME/.misc/socat-gpg.pid

if [[ -f $SOCAT_PID_FILE ]] && kill -0 $(cat $SOCAT_PID_FILE); then
   : # already running
else
    rm "$HOME/.misc/socat-gpg.pid" 2> /dev/null	
    rm -f "$HOME/.gnupg/S.gpg-agent"
    (trap "rm $SOCAT_PID_FILE" EXIT; socat UNIX-LISTEN:"$HOME/.gnupg/S.gpg-agent,fork" EXEC:'/mnt/c/npiperelay.exe -ei -ep -s -a "C:/Users/conta/AppData/Roaming/gnupg/S.gpg-agent"',nofork </dev/null &>/dev/null) &
    echo $! >$SOCAT_PID_FILE
fi

# --- SSH Agent ---
eval $(ssh-agent -s) >/dev/null
